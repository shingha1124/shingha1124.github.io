<!DOCTYPE html>
<html>
<head>
    <meta property="og:title" content="안녕하세요. 하이퍼클럽입니다" />
    <meta property="og:description" content="This is a brief description of my website." />
    <meta property="og:image" content="https://hyper-club.com/images/main/img_main_membership.webp" />
    <meta property="og:url" content="https://example.com" />
    <meta property="og:type" content="website" />
    
    <title>HyperAppLink Redirecting</title>
    <script type="module">
        // 현재 URL에서 도메인과 경로 추출
        const url = new URL(window.location.href);
        const domain = 'dev-app-link.hyper-club.com';
        //const domain = url.hostname;
        const urlParams = new URLSearchParams(url.search);
        const paramKey = urlParams.get('key');
        const paramLink = urlParams.get('link');
        const apiUrl = 'http://localhost:3000';
        
        if (paramKey != null) {
            hasKey();
        } else if (paramLink != null) {
            executeRedirect(paramLink);
        } else {
            document.getElementById('content').innerHTML = '잘못된 AppLink';
        }
        
        function executeRedirect(linkUrl) {
            const redirectUrl = new URL(linkUrl);
            const redirectPath = redirectUrl.pathname;
            const redirectQuery = redirectUrl.search;

            // baseUrl을 도메인만 사용하고, link 파라미터로 경로 및 쿼리 추가
            const baseUrl = `https://${redirectUrl.hostname}`;
            const newUrl = new URL(baseUrl);
            newUrl.searchParams.set('link', redirectPath + redirectQuery);
            window.location.href = newUrl.toString();
        }
        
        function hasKey() {
            fetch(`${apiUrl}/get-data?host=${domain}&key=${paramKey}`)
            .then(response => response.json())
            .then(data => {
                executeRedirect(data.link);
            })
            .catch(error => {
                console.error('서버 호출 중 오류 발생:', error);
            });
        }
    </script>
</head>
</html>
