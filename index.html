
<!DOCTYPE html>
<html>
<head>
    <title>HyperAppLink Redirecting</title>
    <script>
        // 현재 URL에서 도메인과 경로 추출
        const url = new URL(window.location.href);
        //const host = url.hostname;
        const host = 'dev-app-link.hyper-club.com';
        const urlParams = new URLSearchParams(url.search);
        const paramKey = urlParams.get('key');
        const paramLink = urlParams.get('link');
        const apiDomain = 'https://tqp6q0vq90.execute-api.ap-southeast-2.amazonaws.com/Deeplink/getDeeplink';
        
        if (paramKey != null) {
            hasKey();
        } else if (paramLink != null) {
            hasLink();
        } else {
            
        }
        
        function hasLink() {
            console.log("hasLink");
            console.log(paramLink);
            // HTML 콘텐츠에서 URL 분리 (예: https://shingha1124.github.io/homeTab?query=test)
            const redirectUrl = new URL(paramLink);
            const redirectPath = redirectUrl.pathname; // '/homeTab' 추출
            const redirectQuery = redirectUrl.search; // '?query=test' 추출

            // baseUrl을 도메인만 사용하고, link 파라미터로 경로 및 쿼리 추가
            const baseUrl = `https://${redirectUrl.hostname}`; // 'https://shingha1124.github.io'
            const newUrl = new URL(baseUrl);
            newUrl.searchParams.set('link', redirectPath + redirectQuery);
            window.location.href = newUrl.toString();
        }
        
        function hasKey() {
            console.log("hasKey");
            
            fetch(`${apiDomain}?host=${host}&key=${paramKey}`) // 실제 API URL로 변경
              .then(response => {
                if (!response.ok) {
                  throw new Error('네트워크 응답에 문제가 있습니다.');
                }
                return response.json(); // JSON 데이터를 파싱
              })
              .then(data => {
                  console.log(data);
                  /*
                  const redirectUrl = new URL(htmlContent);
                  const redirectPath = redirectUrl.pathname;
                  const redirectQuery = redirectUrl.search;

                  const baseUrl = `https://${redirectUrl.hostname}`;
                  const newUrl = new URL(baseUrl);
                  newUrl.searchParams.set('link', redirectPath + redirectQuery);
                  window.location.href = newUrl.toString();
                   */
              })
              .catch(error => {
                output.textContent = `오류 발생: ${error.message}`;
              });
        }
    </script>
</head>
</html>
